<!doctype html>
<html lang="it">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SaferPlaces Agent â€” Project</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .sidebar {
            min-height: 100vh;
            background-color: #111827;
            color: #fff;
            padding: 1rem;
        }

        .sidebar a {
            color: #adb5bd;
            text-decoration: none;
            display: block;
            margin: .5rem 0;
        }

        .sidebar a:hover {
            color: #fff;
        }

        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .1);
        }
    </style>
</head>

<body data-server='{{ data|tojson }}'>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 sidebar">
                <h4>SaferPlaces Agent</h4>
                <a href="#">Progetti</a>
                <a href="#">Documentazione</a>
            </nav>

            <!-- Contenuto -->
            <main class="col-md-9 col-lg-10 px-4 py-4">
                <h1 class="mb-4">Active projects</h1>
                <div id="projectsGrid" class="container-fluid px-0"></div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="static/js/_utils.js"></script>

    <script>
        const body = document.querySelector('body');
        const serverData = body.dataset.server ? JSON.parse(body.dataset.server) : {};

        function renderProjects(projectsInfo, columnsPerRow = 3) {
            const container = document.getElementById('projectsGrid');
            if (!container) return;
            container.innerHTML = '';


            let rowEl = null;
            projectsInfo.forEach((prjInfo, index) => {
                if (index % columnsPerRow === 0) {
                    rowEl = createEl('div', { class: 'row g-4 mb-0' });
                    container.appendChild(rowEl);
                }

                const colEl = createEl('div', { class: 'col', style :"margin-bottom: 20px"});
                const cardEl = createEl('div', { class: 'card h-100 p-3' });
                const bodyEl = createEl('div', { class: 'card-body' });
                const titleEl = createEl('h5', { class: 'card-title', text: prjInfo.title, onclick: openProject, dataset: {project_id: prjInfo.title}, style: "cursor: pointer" });
                const descEl = createEl('p', { class: 'card-text', text: prjInfo.description });


                bodyEl.appendChild(titleEl);
                bodyEl.appendChild(descEl);
                cardEl.appendChild(bodyEl);
                colEl.appendChild(cardEl);
                rowEl.appendChild(colEl);
            });
        }

        renderProjects(serverData.page_data.projects, 3);
        
        function openProject(event) {
            let project_id = event.target.dataset.project_id;
            console.log(`Opening project at ${project_id}`);
            window.location.href = `/project/${project_id}`;   
        }
    </script>
</body>

</html>